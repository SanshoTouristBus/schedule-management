# 設計書・マニュアル作成ガイドライン

設計書や利用マニュアルを作成する際は、以下の観点を必ず含めること。

---

## 0. ドキュメント全体の構成方針

### 0.1 ドキュメントの階層構造

**推奨: 機能別フラット構造**

```
requirements/
├── README.md           # 索引・ドキュメント一覧
├── feature1.md         # 機能1の詳細
├── feature2.md         # 機能2の詳細
└── ...
```

**メリット**

- 各機能が独立して管理しやすい
- ファイル名が機能名と一致して検索しやすい
- 1機能=1ファイルで管理が明確

**カテゴリ別階層構造との比較**

類似機能が多い場合は、1ファイルにまとめることも検討する：

```
requirements/
├── README.md
├── reports.md          # 複数のレポート機能をまとめる
└── driveInput.md      # ドライバー向け機能をまとめる
```

**まとめる判断基準**

- 機能が類似している（表示形式・データソースが同じ）
- ユーザー層が同じ（例: ドライバー向け）
- ページ数が少ない（3-5ページ程度）

### 0.2 README.md（索引）の作成

**必須項目**

- **概要**: アプリケーションの説明
- **ドキュメント構成**: 各ファイルの構成説明
- **機能別ドキュメント索引**: 全機能の一覧表
- **ナビゲーション構造**: アプリ全体のメニュー構造
- **権限レベル**: ユーザー種別ごとのアクセス範囲

**記載例**

```markdown
## 機能別ドキュメント索引

### 営業所メニュー

| 機能名     | ドキュメント                             | 概要                               |
| ---------- | ---------------------------------------- | ---------------------------------- |
| 営業所設定 | [eigyoshoSettei.md](./eigyoshoSettei.md) | 便・車両・ドライバー等のマスタ設定 |
```

### 0.3 各ドキュメントの標準構成

各機能のドキュメントは以下の4セクションで構成する：

1. **ユーザー目線の機能一覧** - お客様向けの利用マニュアル
2. **設計者目線の詳細仕様** - 技術者向けの実装詳細
3. **テーブル定義書** - 関連するDBテーブルの定義
4. **チェックリスト** - 導入時・運用時の確認事項

---

## 1. アクセス方法の記載

**必須項目**

- **URLパス**: 実際のパスを記載（例: `/tbm/eigyoshoSettei`）
- **ナビゲーション経路**: 画面上のメニューから辿る手順を明記
  - トップメニュー → サブメニュー → 対象ページの階層構造を記載
- **対象ユーザー**: アクセス権限があるユーザー種別（例: 事務員、所長、システム管理者）

**記載例**

```markdown
### アクセス方法

| 方法           | 詳細                                                           |
| -------------- | -------------------------------------------------------------- |
| URL            | `/tbm/eigyoshoSettei`                                          |
| ナビゲーション | 画面上部メニュー → **「営業所メニュー」** → **「営業所設定」** |
| 対象ユーザー   | 事務員、所長、システム管理者                                   |
```

## 2. データ項目の詳細仕様

各データ項目（入力フォーム、マスターデータ等）について、以下を必ず確認・記載する。

**必須記載項目**

- **入力形式**: テキスト、数値、日付、セレクト、チェックボックス等
- **必須/任意**: 必須項目には明確にマーク
- **入力フォーマット**: 特別な形式がある場合（例: 4桁数字、HHMM形式等）
- **バリデーション**: 入力値の制約や検証ルール
- **デフォルト値**: 初期値が設定される場合
- **その他、特記すべき内容**:

**特別な事情・注意点**
以下に該当する項目がないか必ずチェックして記載する：

- **ビジネスロジックへの影響**: 計算式や判定条件に使用される項目
- **他機能との連携**: 他の画面や機能で参照・利用される項目
- **データ型の変換**: 文字列として保存されているが数値として処理される等
- **ユニーク制約**: 重複が許されない値
- **カスケード削除**: 親レコード削除時の動作
- **24時間超対応**: 時刻入力で翌日扱い（例: 2530 = 翌日5:30）等の特殊な仕様
- **その他、特記すべき内容**

**記載例**

```markdown
| 項目名   | 入力形式 | 必須 | 特記事項                                                                      |
| -------- | -------- | ---- | ----------------------------------------------------------------------------- |
| 出発時刻 | テキスト | -    | **4桁数字形式（例: 0800）**。24時間超（例: 2530）にも対応。バリデーションあり |
| 整備代   | テキスト | -    | **給与算定で費用計算に使用**。数値として処理されるため、数値のみ入力          |
| 取引先   | セレクト | -    | **請求書発行に必須**。未設定の場合、請求対象外となる                          |
```

## 3. 機能間の関連性・影響範囲

各機能やマスタ設定について、他の機能への影響を必ず明記する。

**確認すべき観点**

- **依存関係**: この機能を使用する他の機能
- **データフロー**: この機能で登録したデータがどの機能で利用されるか
- **計算への影響**: 金額や回数の計算に使用されるか
- **レポートへの影響**: 集計レポートの出力に影響するか
- **ワークフローへの影響**: 業務フローの前後関係

**記載形式**

- テーブル形式で関連機能と影響内容を明記
- 「この設定が未設定の場合、○○機能が正常に動作しない」等の注意喚起を含める

**記載例**

```markdown
**他機能との関連**

| 関連機能       | 影響内容                                                                             |
| -------------- | ------------------------------------------------------------------------------------ |
| **配車設定**   | 便一覧として表示され、ドライバー・車両を割り当てる単位となる                         |
| **請求書発行** | 取引先（荷主）ごとに便の運行実績を集計して請求書を生成。取引先未設定の便は請求対象外 |
| **給与算定**   | 運賃（TbmRouteGroupFee）を元に乗務員給与を算出                                       |
```

## 4. ナビゲーション構造の記載

アプリケーション全体のナビゲーション構造を記載することで、機能の位置づけを明確にする。

**記載内容**

- メインメニュー構造（階層構造）
- 各ページのメニュー内での位置
- 権限による表示の違いがある場合は明記

**記載例**

```markdown
### ナビゲーション構造
```

運行管理（TBM）
├── 営業所メニュー
│ ├── 営業所設定 ← 本ページ
│ ├── 配車設定
│ └── ETC連携
├── レポート①
│ └── 請求書発行
└── レポート②
└── 給与算定

```

```

## 5. 設計者目線の詳細仕様の記載方法

各機能のドキュメントには、技術者向けの詳細仕様を必ず含めること。

### 5.1 コンポーネント構成

ファイル構造と主要コンポーネントの役割を記載する。

**記載例**

```markdown
### コンポーネント構成
```

feature/
├── page.tsx # サーバーコンポーネント（ページエントリ）
├── FeatureCC.tsx # クライアントコンポーネント
└── components/
├── FeatureTable.tsx # テーブル表示
└── FeatureForm.tsx # 入力フォーム

```

```

### 5.2 データフロー

データの取得から表示までの流れを記載する。

**記載例**

```markdown
### データフロー
```

page.tsx (RSC)
↓ [fetchData でデータ取得]
FeatureCC.tsx (RCC)
↓ [useFeatureData Hook でデータ管理]
FeatureTable.tsx
↓ [テーブル表示]

```

```

### 5.3 URLクエリパラメータ

ページの状態管理に使用するクエリパラメータを表形式で記載する。

**記載例**

```markdown
### URLクエリパラメータ

| パラメータ | 型     | デフォルト | 説明       |
| ---------- | ------ | ---------- | ---------- |
| from       | Date   | 月初       | 表示開始日 |
| to         | Date   | 月末       | 表示終了日 |
| mode       | string | 'ROUTE'    | 表示モード |
```

### 5.4 計算ロジック

重要な計算式やビジネスロジックはコード例を含めて説明する。

**記載例**

````markdown
### 計算ロジック

```typescript
// 燃費の計算
const nempi = kukanKyori / kyuyuryo

// 月間平均燃費
const heikinNempiInPeriod = sokoKyoriInPeriod / sokyuyuRyoInPeriodForAverageCalculation
```
````

````

### 5.5 型定義

主要な型定義を記載する（特に複雑な型や拡張型）。

**記載例**

```markdown
### 主要な型定義

```typescript
type TbmDriveScheduleWithDuplicated = TbmDriveSchedule & {
  TbmRouteGroup: TbmRouteGroup
  TbmVehicle: TbmVehicle
  duplicated: boolean
}
````

```

---

## 6. チェックリスト

設計書・マニュアル作成時に以下の項目を確認すること：

### ドキュメント全体の構成

- [ ] README.md（索引）が作成されている
- [ ] 機能別にドキュメントが分割されている
- [ ] 類似機能は適切にまとめられている（または分割されている）

### 各ドキュメントの内容

- [ ] アクセス方法（URL + ナビゲーション経路）が記載されている
- [ ] 各データ項目に特別な事情・注意点が記載されている
- [ ] 他機能との関連性が表形式で明記されている
- [ ] 入力フォーマットやバリデーションルールが記載されている
- [ ] 必須項目が明確にマークされている
- [ ] データが未設定の場合の影響が記載されている
- [ ] ビジネスロジックへの影響が記載されている

### 設計者向け情報

- [ ] コンポーネント構成が記載されている
- [ ] データフローが記載されている
- [ ] URLクエリパラメータが記載されている
- [ ] 重要な計算ロジックがコード例付きで記載されている
- [ ] 主要な型定義が記載されている
- [ ] テーブル定義（カラム、制約、リレーション）が記載されている

### 運用・導入支援

- [ ] 導入時の確認事項がチェックリスト形式で記載されている
- [ ] 運用時の注意事項が記載されている
- [ ] よくあるトラブルと対処法が記載されている（該当する場合）
```
