観光バス予約管理システム 要件定義書

1. プロジェクト概要

観光バスの予約、車両、乗務員のスケジュールを一元管理するWebアプリケーション。
ガントチャート形式のスケジュール表を中心に、効率的な配車管理と情報の共有を実現する。

2. 共通・基盤要件 (No.1)

2.1 システム基盤

アーキテクチャ: Next.js (App Router), React

データベース: Postgres (prismaをも一縷)

スタイリング: Tailwind CSS

レスポンシブ対応: PCおよびスマートフォンでの表示・操作に対応

2.2 共通機能

認証: ログイン/ログアウト機能（作成済み）

レイアウト: ヘッダー、ナビゲーションを含む共通レイアウト

エラーハンドリング: 共通のエラー表示、ローディング表示

データ処理: 一般的なCRUD処理、論理削除（仮削除）と物理削除（完全削除）の基盤実装

3. 機能要件

3.1 マスタ管理機能 (No.2)

以下のマスタデータのCRUD（作成・読取・更新・削除）機能を提供する。

管理対象データ:

ユーザーマスタ (乗務員含む)

項目: 氏名, メールアドレス, 社用携帯番号, 権限, 乗務員番号, パスワード, 乗務員フラグ

会社マスタ

項目: 会社名

担当者マスタ

項目: 会社ID(FK), 担当者名, 電話番号

※ 1つの会社に対し複数の担当者を紐付ける

車両マスタ

項目: 車両名, プレートNo., 車種, 座席数(正席/補助席), 車両携帯番号

祝日マスタ

項目: 日付, 祝日名 (カレンダー表示用)

3.2 スケジュール管理機能 (No.3, No.10)

本システムのメイン機能。車両×日付のマトリクス表示を行う。

表示形式:

縦軸: 車両

横軸: 日付 (月間表示)

点呼者行: 日付ヘッダーの下に、その日の「点呼者」をユーザーマスタから選択・表示する行を設ける (1日につき1名)。

スケジュール登録項目:

選択項目 (マスタ参照): 顧客情報(会社/担当者), 車両情報, 乗務員(複数選択可)

入力項目: 団体名, 担当者名(手入力), 行き先, ガイドの有無, 出庫/帰庫時間, 備考

操作機能:

新規作成/編集/削除: セルをクリックして操作。

コピー機能 (No.10):

既存スケジュールを選択し「コピー」を実行するとコピーモードへ移行。

画面を暗転させ、コピー先となるセル（車両×日付）を強調表示。

コピー先を複数選択可能（クリックでトグル）。※月跨ぎの選択は不可とする。

「確定」ボタンで、選択したセルへデータを一括複製する。

3.3 ファイル添付機能 (No.4)

各スケジュールに対し、PDFファイル（運行指示書など）を添付可能とする。

制限: ファイル形式はPDFのみ。サイズは1ファイルあたり5MBまで。

3.4 スケジュールの一括登録・削除機能 (No.5)

一括登録: 指定期間（例: 4/1～3/31）、指定ルール（例: 毎週月曜日）に基づいて、同一内容の運行データを一括作成する。

一括削除: 一括作成されたデータグループ（バッチID等で識別）をまとめて削除する機能。削除前には警告を表示する。

3.5 権限管理 (No.6)

ユーザーごとに以下のロール（権限）を付与し、機能制限を行う。

権限

可能な操作

管理者

全データの閲覧・作成・編集・論理削除・完全削除、システム設定、公開範囲設定

編集者

全データの閲覧・作成・編集・論理削除

閲覧者

データの閲覧のみ

3.6 マイページ (乗務員向け) (No.7)

ログインユーザー（乗務員）自身のスケジュールを確認する画面。

表示内容: 日付, 出庫/帰庫時間, 行き先, 団体名, 車両, 担当者などの基本情報。

機能:

運行指示書(PDF)の閲覧・ダウンロード。

ビュー切り替え:

月間ビュー (カレンダー形式)

週間ビュー (日付ごとの縦スクロールリスト)

3.7 公開範囲設定 (No.8)

管理者のみ設定可能。

スケジュールデータの公開範囲（「YYYY年MM月DD日まで」）を設定する。

設定された日付より先のスケジュールは、管理者以外のユーザーには非表示とする（またはマスクする）。

3.8 CSVによる一括登録 (No.9)

外部データを用いたスケジュールの新規一括登録機能。

フロー:

テンプレート出力: ユーザーが対象の「会社名」と「車両」を選択し、専用CSVテンプレートをダウンロードする。

データ作成: ユーザーがCSV上で「運行日」と「団体名」などを入力・転記する。

インポート: CSVファイルをアップロードし、データをシステムに取り込む。

制約: 「新規作成」のみ対応。編集・削除はアプリ上で行う。

4. 非機能要件・その他

UI/UX: ITリテラシーが高くないユーザーでも直感的に操作できるよう、入力フォームのセクション分け、十分な余白、わかりやすいアイコン配置などを心がける。

パフォーマンス: スケジュール表（特に月間ビュー）は描画コストが高くなるため、適切にメモ化や仮想スクロール等を検討し、軽快な動作を実現する。
